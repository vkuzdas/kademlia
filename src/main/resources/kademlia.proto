syntax = "proto3";

// generate directly into "java/proto"
option java_package = "proto";


message LookupRequest {
  string targetId = 1;
  NodeReference joiningNode = 2;
}

message MoveKeysRequest {
  string senderIp = 1;
  int32 senderPort = 2;
  string joiningNodeId = 3;
}

message MoveKeysResponse {
  repeated Entry entries = 1;
}

message Entry {
  string key = 1;
  string value = 2;
}

message LookupResponse {
  repeated NodeReference foundNodes = 1;
}

message NodeReference {
  string ip = 1;
  int32 port = 2;
  string id = 3;
}

message Empty {}

message FindNodeRequest {
  string targetId = 1;
  NodeReference joiningNode = 2;
  NodeReference sender = 3;
}

message FindNodeResponse {
  repeated NodeReference kClosest = 1;
}

message RetrieveRequest {
  string key = 1;
  NodeReference sender = 3;
}

message RetrieveResponse {
  string value = 1;
  Status status = 2;
}

message StoreRequest {
  string key = 1;
  string value = 2;
  NodeReference sender = 3;
}

message StoreResponse {
  Status status = 1;
}

enum Status {
  SUCCESS = 0;
  NOT_FOUND = 1;
  ERROR = 2;
}

service KademliaService {
  rpc PromptNodeLookup(LookupRequest) returns (LookupResponse) {}
  rpc MoveKeys(MoveKeysRequest) returns (MoveKeysResponse) {}

  rpc FindNode(FindNodeRequest) returns (FindNodeResponse) {}
  rpc Retrieve(RetrieveRequest) returns (RetrieveResponse) {}
  rpc Store(StoreRequest) returns (StoreResponse) {}
  rpc Ping(Empty) returns (Empty) {}
}